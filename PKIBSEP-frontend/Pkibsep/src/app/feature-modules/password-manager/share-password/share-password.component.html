<h2 mat-dialog-title>Podeli Lozinku za "{{ passwordEntry.siteName }}"</h2>

<mat-dialog-content>
  <form [formGroup]="shareForm">
    <!-- Izbor korisnika -->
    <mat-form-field class="full-width" *ngIf="!isLoadingUsers">
      <mat-label>Izaberite korisnika</mat-label>
      <mat-select formControlName="targetUserId" required>
        <mat-option *ngFor="let user of availableUsers" [value]="user.id">
          {{ user.email }} ({{ user.username }})
        </mat-option>
      </mat-select>
      <mat-error *ngIf="shareForm.get('targetUserId')?.hasError('required')">
        Izaberite korisnika
      </mat-error>
    </mat-form-field>

    <!-- Loading spinner -->
    <div *ngIf="isLoadingUsers" class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Učitavanje dostupnih korisnika...</p>
    </div>

    <!-- Poruka ako nema dostupnih korisnika -->
    <div *ngIf="!isLoadingUsers && availableUsers.length === 0" class="no-users-message">
      <mat-icon>info</mat-icon>
      <p>Nema dostupnih korisnika za deljenje. Svi aktivni korisnici sa ključevima već imaju pristup ovoj lozinci.</p>
    </div>

    <!-- Upload privatnog ključa -->
    <div class="private-key-section" *ngIf="!isLoadingUsers && availableUsers.length > 0">
      <label class="file-upload-label">
        <input
          type="file"
          accept=".pem"
          (change)="onPrivateKeySelected($event)"
          style="display: none;"
          #fileInput
        />
        <button
          mat-raised-button
          type="button"
          (click)="fileInput.click()"
          [disabled]="isSubmitting"
        >
          <mat-icon>upload_file</mat-icon>
          Učitaj Privatni Ključ
        </button>
        <span *ngIf="privateKeyFileName" class="file-name">{{ privateKeyFileName }}</span>
      </label>

      <div class="info-box">
        <mat-icon>info</mat-icon>
        <p>Potreban je vaš privatni ključ da biste re-enkriptovali lozinku za drugog korisnika.</p>
      </div>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()" [disabled]="isSubmitting">Otkaži</button>
  <button
    mat-raised-button
    color="primary"
    (click)="onSubmit()"
    [disabled]="shareForm.invalid || !privateKeyPem || isSubmitting || availableUsers.length === 0"
  >
    <span *ngIf="!isSubmitting">Podeli</span>
    <span *ngIf="isSubmitting">Deljenje...</span>
  </button>
</mat-dialog-actions>
