<div class="password-manager-container">
  <h1>Password Manager</h1>

  <div *ngIf="!hasKeys" class="no-keys-warning">
    <mat-icon class="warning-icon">warning</mat-icon>
    <p>Nemate generisan par ključeva za Password Manager.</p>
    <p>Molimo vas da prvo generišete ključeve na stranici <a routerLink="/profile">Profil</a>.</p>
  </div>

  <div *ngIf="hasKeys">
    <!-- Search and Add button -->
    <div class="toolbar">
      <mat-form-field class="search-field">
        <mat-label>Pretraga</mat-label>
        <input matInput [(ngModel)]="searchTerm" (input)="onSearch()" placeholder="Naziv sajta, korisničko ime...">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>

      <button mat-raised-button color="primary" (click)="openAddPasswordDialog()">
        <mat-icon>add</mat-icon>
        Dodaj Novu Lozinku
      </button>
    </div>

    <!-- Loading spinner -->
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner></mat-spinner>
    </div>

    <!-- Passwords table -->
    <div *ngIf="!isLoading && filteredPasswords.length > 0" class="table-container">
      <table mat-table [dataSource]="filteredPasswords" class="mat-elevation-z2">
        <!-- Site Name Column -->
        <ng-container matColumnDef="siteName">
          <th mat-header-cell *matHeaderCellDef>Naziv Sajta</th>
          <td mat-cell *matCellDef="let password">{{ password.siteName }}</td>
        </ng-container>

        <!-- Username Column -->
        <ng-container matColumnDef="username">
          <th mat-header-cell *matHeaderCellDef>Korisničko Ime</th>
          <td mat-cell *matCellDef="let password">{{ password.username }}</td>
        </ng-container>

        <!-- Owner Column -->
        <ng-container matColumnDef="owner">
          <th mat-header-cell *matHeaderCellDef>Vlasnik</th>
          <td mat-cell *matCellDef="let password">
            <span *ngIf="password.isOwner" class="owner-badge">Vi</span>
            <span *ngIf="!password.isOwner">{{ password.ownerEmail }}</span>
          </td>
        </ng-container>

        <!-- Created At Column -->
        <ng-container matColumnDef="createdAt">
          <th mat-header-cell *matHeaderCellDef>Kreirano</th>
          <td mat-cell *matCellDef="let password">{{ password.createdAt | date:'dd.MM.yyyy' }}</td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Akcije</th>
          <td mat-cell *matCellDef="let password">
            <button mat-icon-button color="primary" (click)="viewPassword(password)" matTooltip="Prikaži lozinku">
              <mat-icon>visibility</mat-icon>
            </button>
            <button mat-icon-button color="accent" (click)="sharePassword(password)"
                    [disabled]="!password.isOwner"
                    matTooltip="Podeli lozinku">
              <mat-icon>share</mat-icon>
            </button>
            <button mat-icon-button (click)="viewShares(password)"
                    [disabled]="!password.isOwner"
                    matTooltip="Prikaži sa kim je podeljeno">
              <mat-icon>people</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="deletePassword(password)"
                    [disabled]="!password.isOwner"
                    matTooltip="Obriši lozinku">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </div>

    <!-- No passwords message -->
    <div *ngIf="!isLoading && filteredPasswords.length === 0" class="no-passwords">
      <mat-icon>lock_open</mat-icon>
      <p *ngIf="passwords.length === 0">Nemate sačuvanih lozinki.</p>
      <p *ngIf="passwords.length > 0 && searchTerm">Nema rezultata za pretragu "{{ searchTerm }}".</p>
    </div>
  </div>
</div>
