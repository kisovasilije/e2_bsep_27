<div class="certificate-list-container">
  <h2>Certificates</h2>

  <div class="actions-bar">
    <button
      *ngIf="isAdmin()"
      mat-raised-button
      color="primary"
      (click)="navigateToCreateRoot()">
      Create Root CA
    </button>

    <button
      *ngIf="isAdmin() || isCaUser()"
      mat-raised-button
      color="accent"
      (click)="navigateToIssueIntermediate()">
      Issue Intermediate Certificate
    </button>
  </div>

  <div *ngIf="certificates.length > 0">
    <table mat-table [dataSource]="certificates" class="certificate-table">

      <ng-container matColumnDef="serialNumber">
        <th mat-header-cell *matHeaderCellDef>Serial Number</th>
        <td mat-cell *matCellDef="let cert">{{ cert.serialHex }}</td>
      </ng-container>

      <ng-container matColumnDef="commonName">
        <th mat-header-cell *matHeaderCellDef>Subject DN</th>
        <td mat-cell *matCellDef="let cert">{{ cert.subjectDN }}</td>
      </ng-container>

      <ng-container matColumnDef="organization">
        <th mat-header-cell *matHeaderCellDef>Issuer DN</th>
        <td mat-cell *matCellDef="let cert">{{ cert.issuerDN }}</td>
      </ng-container>

      <ng-container matColumnDef="validFrom">
        <th mat-header-cell *matHeaderCellDef>Valid From</th>
        <td mat-cell *matCellDef="let cert">{{ cert.notBeforeUtc | date: 'short' }}</td>
      </ng-container>

      <ng-container matColumnDef="validTo">
        <th mat-header-cell *matHeaderCellDef>Valid To</th>
        <td mat-cell *matCellDef="let cert">{{ cert.notAfterUtc | date: 'short' }}</td>
      </ng-container>

      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef>Type</th>
        <td mat-cell *matCellDef="let cert">{{ getCertificateType(cert) }}</td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let cert">
          <button mat-icon-button (click)="downloadCertificate(cert.id)" matTooltip="Download">
            <mat-icon>download</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>

  <div *ngIf="certificates.length === 0" class="no-certificates">
    <p>No certificates found. Create your first certificate using the buttons above.</p>
  </div>
</div>
